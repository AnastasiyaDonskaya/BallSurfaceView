<html>
<head>
<title>BallSurfaceView.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
BallSurfaceView.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">com.example.surfaceviewcolorchange</span><span class="s0">;</span>

import <span class="s1">android.content.Context</span><span class="s0">;</span>
import <span class="s1">android.graphics.Canvas</span><span class="s0">;</span>
import <span class="s1">android.graphics.Color</span><span class="s0">;</span>
import <span class="s1">android.graphics.Paint</span><span class="s0">;</span>
import <span class="s1">android.graphics.Rect</span><span class="s0">;</span>
import <span class="s1">android.util.AttributeSet</span><span class="s0">;</span>
import <span class="s1">android.util.Log</span><span class="s0">;</span>
import <span class="s1">android.view.SurfaceHolder</span><span class="s0">;</span>
import <span class="s1">android.view.SurfaceView</span><span class="s0">;</span>


import <span class="s1">androidx.constraintlayout.solver.widgets.Rectangle</span><span class="s0">;</span>

import <span class="s1">java.util.Random</span><span class="s0">;</span>

public class <span class="s1">BallSurfaceView </span><span class="s0">extends </span><span class="s1">SurfaceView </span><span class="s0">implements </span><span class="s1">SurfaceHolder.Callback {</span>
    SurfaceHolder holder<span class="s0">;</span>
    <span class="s1">DrawThread thread</span><span class="s0">;</span>
    int <span class="s1">color = Color.BLACK</span><span class="s0">, </span><span class="s1">ballColor = Color.RED</span><span class="s0">, </span><span class="s1">ballColor2 = Color.YELLOW</span><span class="s0">, </span><span class="s1">rectColor = Color.WHITE</span><span class="s0">;</span>
    float <span class="s1">xPos = </span><span class="s2">300</span><span class="s0">, </span><span class="s1">yPos = </span><span class="s2">300</span><span class="s0">, </span><span class="s1">x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">;</span>
    int <span class="s1">width</span><span class="s0">, </span><span class="s1">height</span><span class="s0">;</span>
    <span class="s1">Paint ballPaint = </span><span class="s0">new </span><span class="s1">Paint()</span><span class="s0">;</span>
    <span class="s1">Paint ballPaint2 = </span><span class="s0">new </span><span class="s1">Paint()</span><span class="s0">;</span>
    <span class="s1">Paint rectPaint = </span><span class="s0">new </span><span class="s1">Paint()</span><span class="s0">;</span>
    <span class="s3">//Rect rect = new Rect();</span>
    <span class="s1">Random r = </span><span class="s0">new </span><span class="s1">Random()</span><span class="s0">;</span>
    float <span class="s1">xPos2 = r.nextFloat() * </span><span class="s2">300</span><span class="s0">, </span><span class="s1">yPos2 = r.nextFloat() * </span><span class="s2">300</span><span class="s0">, </span><span class="s1">x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">;</span>
    int <span class="s1">radius</span><span class="s0">;</span>

    public void <span class="s1">changeColor() {</span>
        Random r = <span class="s0">new </span><span class="s1">Random()</span><span class="s0">;</span>
        <span class="s1">ballColor = Color.rgb(r.nextInt(</span><span class="s2">150</span><span class="s1">) * </span><span class="s2">10</span><span class="s0">,</span><span class="s1">r.nextInt(</span><span class="s2">150</span><span class="s1">) * </span><span class="s2">10</span><span class="s0">,</span><span class="s1">r.nextInt(</span><span class="s2">150</span><span class="s1">) * </span><span class="s2">10</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>
    <span class="s0">public void </span><span class="s1">changeColor2() {</span>
        Random r = <span class="s0">new </span><span class="s1">Random()</span><span class="s0">;</span>
        <span class="s1">ballColor2 = Color.rgb(r.nextInt(</span><span class="s2">150</span><span class="s1">) * </span><span class="s2">10</span><span class="s0">,</span><span class="s1">r.nextInt(</span><span class="s2">150</span><span class="s1">) * </span><span class="s2">10</span><span class="s0">,</span><span class="s1">r.nextInt(</span><span class="s2">150</span><span class="s1">) * </span><span class="s2">10</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>
    <span class="s0">class </span><span class="s1">DrawThread </span><span class="s0">extends </span><span class="s1">Thread {</span>
        <span class="s0">boolean </span><span class="s1">runFlag = </span><span class="s0">true;</span>

        public <span class="s1">DrawThread(SurfaceHolder holder) {</span>
            <span class="s0">this</span><span class="s1">.holder = holder</span><span class="s0">;</span>
        <span class="s1">}</span>

        SurfaceHolder holder<span class="s0">;</span>
        <span class="s1">@Override</span>
        <span class="s0">public void </span><span class="s1">run() {</span>
            <span class="s0">super</span><span class="s1">.run()</span><span class="s0">;</span>
            while <span class="s1">(runFlag) {</span>
                Canvas c = holder.lockCanvas()<span class="s0">;</span>
                <span class="s3">//Rect r = holder.getSurfaceFrame();</span>
                // if (r != null) {
                //  r.centerX();
                //  rectPaint.setColor(rectColor);
                //}
                <span class="s0">if </span><span class="s1">(c != </span><span class="s0">null</span><span class="s1">) {</span>
                    ballPaint.setColor(ballColor)<span class="s0">;</span>
                    <span class="s1">ballPaint2.setColor(ballColor2)</span><span class="s0">;</span>
                    <span class="s1">c.drawColor(color)</span><span class="s0">;</span>
                    <span class="s1">x += xPos * </span><span class="s2">0.1</span><span class="s0">;</span>
                    <span class="s1">y += yPos * </span><span class="s2">0.1</span><span class="s0">; </span><span class="s3">//смещение шарика</span>

                    <span class="s1">x2 += xPos2 * </span><span class="s2">0.1</span><span class="s0">;</span>
                    <span class="s1">y2 += yPos2 * </span><span class="s2">0.1</span><span class="s0">;</span>

                    if <span class="s1">(x &gt; c.getWidth() || x &lt; </span><span class="s2">0</span><span class="s1">) {</span>
                        xPos = -xPos<span class="s0">;</span>
                        <span class="s1">changeColor()</span><span class="s0">;</span>
                    <span class="s1">}</span>
                    <span class="s0">if </span><span class="s1">(y &gt; c.getHeight() || y &lt; </span><span class="s2">0</span><span class="s1">) {</span>
                        yPos = -yPos<span class="s0">;</span>
                        <span class="s1">changeColor()</span><span class="s0">;</span>
                    <span class="s1">}</span>
                    <span class="s0">if </span><span class="s1">(x2 &gt; c.getWidth() || x2 &lt; </span><span class="s2">0</span><span class="s1">) {</span>
                        xPos2 = -xPos2<span class="s0">;</span>
                        <span class="s1">changeColor2()</span><span class="s0">;</span>
                    <span class="s1">}</span>
                    <span class="s0">if </span><span class="s1">(y2 &gt; c.getHeight() || y2 &lt; </span><span class="s2">0</span><span class="s1">) {</span>
                        yPos2 = -yPos2<span class="s0">;</span>
                        <span class="s1">changeColor2()</span><span class="s0">;</span>
                    <span class="s1">}</span>

                    <span class="s0">if </span><span class="s1">((x &gt; x2 - </span><span class="s2">30 </span><span class="s1">&amp;&amp; x &lt; x2 + </span><span class="s2">30</span><span class="s1">) &amp;&amp; (y &gt; y2 - </span><span class="s2">30 </span><span class="s1">&amp;&amp; y &lt; y2 + </span><span class="s2">30</span><span class="s1">)) {</span>
                        changeColor()<span class="s0">;</span>
                        <span class="s1">changeColor2()</span><span class="s0">;</span>
                        if <span class="s1">(x &gt; y || x2 &gt; y2) {</span>
                            xPos = -xPos<span class="s0">;</span>
                            <span class="s1">xPos2 = -xPos2</span><span class="s0">;</span>
                        <span class="s1">}</span>
                        <span class="s0">else if </span><span class="s1">(y &gt; x || y2 &gt; x2) {</span>
                            yPos = -yPos<span class="s0">;</span>
                            <span class="s1">yPos2 = -yPos2</span><span class="s0">;</span>
                        <span class="s1">}</span>
                        <span class="s0">else </span><span class="s1">{</span>
                            xPos = -xPos<span class="s0">;</span>
                            <span class="s1">xPos2 = -xPos2</span><span class="s0">;</span>
                            <span class="s1">yPos = -yPos</span><span class="s0">;</span>
                            <span class="s1">yPos2 = -yPos2</span><span class="s0">;</span>
                        <span class="s1">}</span>
                    }

                    c.drawCircle(x<span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s2">30</span><span class="s0">, </span><span class="s1">ballPaint)</span><span class="s0">;</span>
                    <span class="s1">c.drawCircle(x2</span><span class="s0">, </span><span class="s1">y2</span><span class="s0">, </span><span class="s2">30</span><span class="s0">, </span><span class="s1">ballPaint2)</span><span class="s0">;</span>
                    <span class="s1">holder.unlockCanvasAndPost(c)</span><span class="s0">;</span>
                    try <span class="s1">{</span>
                        Thread.sleep(<span class="s2">100</span><span class="s1">)</span><span class="s0">; </span><span class="s1">}</span>
                    <span class="s0">catch </span><span class="s1">(InterruptedException e) {}</span>
                }

            }
        }
    }

<span class="s3">//    public void onClick() {</span>
//        Runnable runnable = new Runnable() {
//            public void run() {
//                // Переносим сюда старый код
//                long endTime = System.currentTimeMillis()
//                        + 20 * 1000;
//
//                while (System.currentTimeMillis() &lt; endTime) {
//                    synchronized (this) {
//                        try {
//                            wait(endTime -
//                                    System.currentTimeMillis());
//                        } catch (Exception e) {
//                        }
//                    }
//                }
//                Log.i(&quot;Thread&quot;, &quot;Сегодня коты перебегали дорогу: &quot; + mCounter++ + &quot; раз&quot;);
//            }
//        };
//        Thread thread = new Thread(runnable);
//        thread.start();
//    }

    <span class="s0">public </span><span class="s1">BallSurfaceView(Context context</span><span class="s0">, </span><span class="s1">AttributeSet attrs) {</span>
        <span class="s0">super</span><span class="s1">(context</span><span class="s0">, </span><span class="s1">attrs)</span><span class="s0">;</span>
        <span class="s3">//этот класс является обработчиком событий с поверхностью</span>
        <span class="s1">getHolder().addCallback(</span><span class="s0">this</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    @Override
    <span class="s0">public void </span><span class="s1">surfaceCreated(SurfaceHolder holder) {</span>
        <span class="s3">// запустить поток отрисовки</span>
        <span class="s1">x = </span><span class="s2">500</span><span class="s0">;</span>
        <span class="s1">y = </span><span class="s2">500</span><span class="s0">;</span>
        <span class="s1">x2 = </span><span class="s2">10 </span><span class="s1">+ r.nextFloat() * </span><span class="s2">500</span><span class="s0">;</span>
        <span class="s1">y2 = </span><span class="s2">10 </span><span class="s1">+ r.nextFloat() * </span><span class="s2">500</span><span class="s0">;</span>
        <span class="s1">radius = </span><span class="s2">50</span><span class="s0">;</span>
        <span class="s1">ballPaint = </span><span class="s0">new </span><span class="s1">Paint()</span><span class="s0">;</span>
        <span class="s1">ballPaint2 = </span><span class="s0">new </span><span class="s1">Paint()</span><span class="s0">;</span>
        <span class="s1">Rect surfaceFrame = holder.getSurfaceFrame()</span><span class="s0">;</span>
        <span class="s1">width = surfaceFrame.width()</span><span class="s0">;</span>
        <span class="s1">height = surfaceFrame.height()</span><span class="s0">;</span>
        <span class="s1">xPos = width / </span><span class="s2">2</span><span class="s0">;</span>
        <span class="s1">yPos = radius</span><span class="s0">;</span>

        <span class="s1">xPos2 = radius + </span><span class="s2">10</span><span class="s0">;</span>
        <span class="s1">yPos2 = height / </span><span class="s2">2</span><span class="s0">;</span>

        <span class="s1">thread = </span><span class="s0">new </span><span class="s1">DrawThread(holder)</span><span class="s0">;</span>
        <span class="s1">thread.start()</span><span class="s0">;</span>
        <span class="s1">Log.d(</span><span class="s4">&quot;mytag&quot;</span><span class="s0">, </span><span class="s4">&quot;DrawThread is running&quot;</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    @Override
    <span class="s0">protected void </span><span class="s1">onDraw(Canvas canvas) {</span>
        canvas.drawColor(Color.WHITE)<span class="s0">;</span>
        <span class="s1">canvas.drawCircle(xPos</span><span class="s0">, </span><span class="s1">yPos</span><span class="s0">, </span><span class="s1">radius</span><span class="s0">, </span><span class="s1">ballPaint)</span><span class="s0">;</span>
        <span class="s3">//canvas.drawRect(rect, rectPaint);</span>
        //запустить поток отрисовки
        <span class="s1">thread = </span><span class="s0">new </span><span class="s1">DrawThread(holder)</span><span class="s0">;</span>
        <span class="s1">thread.start()</span><span class="s0">;</span>
        <span class="s1">Log.d(</span><span class="s4">&quot;mytag&quot;</span><span class="s0">, </span><span class="s4">&quot;DrawThread is running&quot;</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>
<span class="s3">//</span>
//    protected void onDraw(Canvas rect) {
//        rect.drawRect();
//        rect.height();
//        //запустить поток отрисовки
//        thread = new DrawThread(holder);
//        thread.start();
//        Log.d(&quot;mytag&quot;, &quot;DrawThread is running&quot;);
//    }

    <span class="s1">@Override</span>
    <span class="s0">public void </span><span class="s1">surfaceChanged(SurfaceHolder holder</span><span class="s0">, int </span><span class="s1">format</span><span class="s0">, int </span><span class="s1">width</span><span class="s0">, int </span><span class="s1">height) {</span>
        thread.runFlag = <span class="s0">false;</span>
        <span class="s1">thread = </span><span class="s0">new </span><span class="s1">DrawThread(holder)</span><span class="s0">;</span>
        <span class="s1">thread.start()</span><span class="s0">;</span>
        <span class="s3">// перезапустить поток</span>
    <span class="s1">}</span>

    @Override
    <span class="s0">public void </span><span class="s1">surfaceDestroyed(SurfaceHolder holder) {</span>
        thread.runFlag = <span class="s0">false;</span>
        <span class="s3">// остановить поток</span>
    <span class="s1">}</span>
}
</pre>
</body>
</html>