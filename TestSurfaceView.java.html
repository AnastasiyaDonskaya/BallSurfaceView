<html>
<head>
<title>TestSurfaceView.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
TestSurfaceView.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">com.example.surfaceviewcolorchange</span><span class="s0">;</span>

import <span class="s1">android.content.Context</span><span class="s0">;</span>
import <span class="s1">android.graphics.Canvas</span><span class="s0">;</span>
import <span class="s1">android.graphics.Color</span><span class="s0">;</span>
import <span class="s1">android.graphics.Paint</span><span class="s0">;</span>
import <span class="s1">android.util.AttributeSet</span><span class="s0">;</span>
import <span class="s1">android.util.Log</span><span class="s0">;</span>
import <span class="s1">android.view.SurfaceHolder</span><span class="s0">;</span>
import <span class="s1">android.view.SurfaceView</span><span class="s0">;</span>

import <span class="s1">java.util.Random</span><span class="s0">;</span>

public class <span class="s1">TestSurfaceView </span><span class="s0">extends </span><span class="s1">SurfaceView </span><span class="s0">implements </span><span class="s1">SurfaceHolder.Callback {</span>
    <span class="s2">//SurfaceHolder holder;</span>
    <span class="s1">DrawThread thread</span><span class="s0">;</span>

    int <span class="s1">color = Color.RED</span><span class="s0">;</span>



<span class="s2">//    public void changeColor() {</span>
//        Random r = new Random();
//        color = Color.rgb(r.nextInt(255),r.nextInt(255),r.nextInt(255));
//    }
    <span class="s0">class </span><span class="s1">DrawThread </span><span class="s0">extends </span><span class="s1">Thread {</span>
        <span class="s0">float </span><span class="s1">x = </span><span class="s3">300</span><span class="s0">, </span><span class="s1">y = </span><span class="s3">300</span><span class="s0">;</span>
        <span class="s1">Random r = </span><span class="s0">new </span><span class="s1">Random()</span><span class="s0">;</span>
        <span class="s1">Paint p = </span><span class="s0">new </span><span class="s1">Paint()</span><span class="s0">;</span>
        boolean <span class="s1">runFlag = </span><span class="s0">true;</span>

        public <span class="s1">DrawThread(SurfaceHolder holder) {</span>
            <span class="s0">this</span><span class="s1">.holder = holder</span><span class="s0">;</span>
        <span class="s1">}</span>

        SurfaceHolder holder<span class="s0">;</span>
        <span class="s1">@Override</span>
        <span class="s0">public void </span><span class="s1">run() {</span>
            <span class="s0">super</span><span class="s1">.run()</span><span class="s0">;</span>
            <span class="s1">p.setColor(Color.YELLOW)</span><span class="s0">;</span>

            while <span class="s1">(runFlag) {</span>
                Canvas c = holder.lockCanvas()<span class="s0">;</span>
                if <span class="s1">(c != </span><span class="s0">null</span><span class="s1">) {</span>
                    c.drawColor(color)<span class="s0">;</span>
                    <span class="s2">//changeColor();</span>
                    <span class="s1">x += r.nextFloat() * </span><span class="s3">10 </span><span class="s1">- </span><span class="s3">5</span><span class="s0">;</span>
                    <span class="s1">y += r.nextFloat() * </span><span class="s3">10 </span><span class="s1">- </span><span class="s3">5</span><span class="s0">;</span>
                    <span class="s1">c.drawCircle(x</span><span class="s0">, </span><span class="s1">y</span><span class="s0">, </span><span class="s3">30</span><span class="s0">, </span><span class="s1">p)</span><span class="s0">;</span>
                    <span class="s1">holder.unlockCanvasAndPost(c)</span><span class="s0">;</span>
                    try <span class="s1">{</span>
                    Thread.sleep(<span class="s3">100</span><span class="s1">)</span><span class="s0">; </span><span class="s1">}</span>
                    <span class="s0">catch </span><span class="s1">(InterruptedException e) {}</span>
                }
            }
            <span class="s2">// задание: реализовать плавную смену цвета</span>
            // палитру выбирайте сами
        <span class="s1">}</span>
    }


    <span class="s0">public </span><span class="s1">TestSurfaceView(Context context</span><span class="s0">, </span><span class="s1">AttributeSet attrs) {</span>
        <span class="s0">super</span><span class="s1">(context</span><span class="s0">, </span><span class="s1">attrs)</span><span class="s0">;</span>
        <span class="s2">// этот класс является обработчиком событий с поверхностью</span>
        <span class="s1">getHolder().addCallback(</span><span class="s0">this</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    @Override
    <span class="s0">public void </span><span class="s1">surfaceCreated(SurfaceHolder holder) {</span>
        <span class="s2">//запустить поток отрисовки</span>
        <span class="s1">thread = </span><span class="s0">new </span><span class="s1">DrawThread(holder)</span><span class="s0">;</span>
        <span class="s1">thread.start()</span><span class="s0">;</span>
        <span class="s1">Log.d(</span><span class="s4">&quot;mytag&quot;</span><span class="s0">, </span><span class="s4">&quot;DrawThread is running&quot;</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    @Override
    <span class="s0">public void </span><span class="s1">surfaceChanged(SurfaceHolder holder</span><span class="s0">, int </span><span class="s1">format</span><span class="s0">, int </span><span class="s1">width</span><span class="s0">, int </span><span class="s1">height) {</span>
        thread.runFlag = <span class="s0">false;</span>
        <span class="s1">thread = </span><span class="s0">new </span><span class="s1">DrawThread(holder)</span><span class="s0">;</span>
        <span class="s1">thread.start()</span><span class="s0">;</span>
        <span class="s2">// перезапустить поток</span>
    <span class="s1">}</span>

    @Override
    <span class="s0">public void </span><span class="s1">surfaceDestroyed(SurfaceHolder holder) {</span>
        thread.runFlag = <span class="s0">false;</span>
        <span class="s2">// остановить поток</span>
    <span class="s1">}</span>
}
</pre>
</body>
</html>